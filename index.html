<!doctype html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Nga Ngố</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" defer></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: Arial, sans-serif;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            margin-top: 20px;
            margin-bottom: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        @media (min-width: 768px) {
            .container {
                padding: 30px;
            }
        }

        .container-title {
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            color: #4a5568;
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        @media (min-width: 768px) {
            .container-title {
                font-size: 28px;
            }
        }

        .container-greeting {
            background: linear-gradient(45deg, #f8f9ff, #e8f4f8);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            margin-bottom: 30px;
        }

        .question {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #28a745;
        }

        @media (min-width: 768px) {
            .question {
                padding: 20px;
            }
        }

        .question-title {
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 15px;
        }

        .required {
            color: #e53e3e;
        }

        .form-check {
            margin-bottom: 10px;
            padding: 8px;
        }

        .form-check:hover {
            background-color: #e2e8f0;
            border-radius: 5px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .modal-content {
            border-radius: 15px;
            border: none;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            margin: 10px;
            max-height: 90vh;
            overflow-y: auto;
        }

        @media (min-width: 768px) {
            .modal-content {
                margin: 0;
            }
        }

        .modal-header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px 15px 0 0;
        }

        .mbti-result {
            text-align: center;
            padding: 20px;
        }

        .mbti-type {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .breakdown-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .breakdown-letter {
            font-weight: bold;
            color: #667eea;
            font-size: 18px;
        }

        .summary-section {
            background: linear-gradient(45deg, #f8f9ff, #e8f4f8);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="container-title">Đánh Giá MBTI và Tư Vấn Nghề Nghiệp</div>
        <div class="container-greeting text-center">
            <h5>Hệ thống đánh giá tính cách MBTI giúp bạn hiểu rõ bản thân và đưa ra những lời khuyên phù hợp cho sự
                nghiệp của mình.</h5>
            <br>
            <i>Vui lòng điền đẩy đủ thông tin cho các câu hỏi có đánh dấu <span class="required">*</span> và sau đó
                ấn
                Nộp Bài.</i>
        </div>
        <div id="container-content">
            <div class="py-3 text-center">
                <hr width="50%" class="mx-auto">
            </div>
            <form id="quiz-form">
                <div class="question">
                    <div class="question-title">1. Bạn cảm thấy năng lượng đến từ đâu? <span class="required">*</span>
                    </div>
                    <div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q1" id="q1-1"
                                value="a) Từ việc giao tiếp và tương tác với mọi người.">
                            <label class="form-check-label" for="q1-1">
                                a) Từ việc giao tiếp và tương tác với mọi người.
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q1" id="q1-2"
                                value="b) Từ thời gian một mình, suy nghĩ sâu về những gì đang xảy ra.">
                            <label class="form-check-label" for="q1-2">
                                b) Từ thời gian một mình, suy nghĩ sâu về những gì đang xảy ra.
                            </label>
                        </div>
                    </div>
                </div>
                <div class="question">
                    <div class="question-title">2. Bạn thường ưu tiên điều gì khi ra quyết định? <span
                            class="required">*</span></div>
                    <div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q2" id="q2-1"
                                value="a) Lý trí, phân tích các yếu tố khách quan.">
                            <label class="form-check-label" for="q2-1">
                                a) Lý trí, phân tích các yếu tố khách quan.
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q2" id="q2-2"
                                value="b) Cảm xúc và cách nó ảnh hưởng đến mọi người xung quanh.">
                            <label class="form-check-label" for="q2-2">
                                b) Cảm xúc và cách nó ảnh hưởng đến mọi người xung quanh.
                            </label>
                        </div>
                    </div>
                </div>
                <div class="question">
                    <div class="question-title">3. Bạn thích làm gì hơn trong công việc hoặc học tập? <span
                            class="required">*</span></div>
                    <div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q3" id="q3-1"
                                value="a) Làm theo một kế hoạch rõ ràng và có sự tổ chức.">
                            <label class="form-check-label" for="q3-1">
                                a) Làm theo một kế hoạch rõ ràng và có sự tổ chức.
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q3" id="q3-2"
                                value="b) Linh hoạt, thích khám phá và làm việc theo cách của riêng mình.">
                            <label class="form-check-label" for="q3-2">
                                b) Linh hoạt, thích khám phá và làm việc theo cách của riêng mình.
                            </label>
                        </div>
                    </div>
                </div>
                <div class="question">
                    <div class="question-title">4. Khi gặp một vấn đề mới, bạn thường làm gì? <span
                            class="required">*</span></div>
                    <div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q4" id="q4-1"
                                value="a) Tập trung vào các chi tiết cụ thể, làm theo hướng dẫn đã có.">
                            <label class="form-check-label" for="q4-1">
                                a) Tập trung vào các chi tiết cụ thể, làm theo hướng dẫn đã có.
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q4" id="q4-2"
                                value="b) Dành thời gian suy nghĩ về các khả năng và cách giải quyết khác nhau.">
                            <label class="form-check-label" for="q4-2">
                                b) Dành thời gian suy nghĩ về các khả năng và cách giải quyết khác nhau.
                            </label>
                        </div>
                    </div>
                </div>
                <div class="question">
                    <div class="question-title">5. Bạn cảm thấy thoải mái hơn trong tình huống nào? <span
                            class="required">*</span></div>
                    <div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q5" id="q5-1"
                                value="a) Thích ở những nơi có người khác, năng động, nói chuyện nhiều.">
                            <label class="form-check-label" for="q5-1">
                                a) Thích ở những nơi có người khác, năng động, nói chuyện nhiều.
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q5" id="q5-2"
                                value="b) Thích ở một mình hoặc trong nhóm nhỏ, yên tĩnh.">
                            <label class="form-check-label" for="q5-2">
                                b) Thích ở một mình hoặc trong nhóm nhỏ, yên tĩnh.
                            </label>
                        </div>
                    </div>
                </div>
                <div class="question">
                    <div class="question-title">6. Khi phải hoàn thành một công việc, bạn sẽ làm gì trước? <span
                            class="required">*</span></div>
                    <div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q6" id="q6-1"
                                value="a) Lập kế hoạch và bắt tay vào làm ngay.">
                            <label class="form-check-label" for="q6-1">
                                a) Lập kế hoạch và bắt tay vào làm ngay.
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q6" id="q6-2"
                                value="b) Chờ đợi, tìm thêm thông tin và tùy cơ ứng biến.">
                            <label class="form-check-label" for="q6-2">
                                b) Chờ đợi, tìm thêm thông tin và tùy cơ ứng biến.
                            </label>
                        </div>
                    </div>
                </div>
                <div class="question">
                    <div class="question-title">7. Bạn thích kiểu công việc nào hơn? <span class="required">*</span>
                    </div>
                    <div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q7" id="q7-1"
                                value="a) Công việc cụ thể, rõ ràng với các yêu cầu chi tiết.">
                            <label class="form-check-label" for="q7-1">
                                a) Công việc cụ thể, rõ ràng với các yêu cầu chi tiết.
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q7" id="q7-2"
                                value="b) Công việc đòi hỏi sự sáng tạo và có không gian để thử nghiệm.">
                            <label class="form-check-label" for="q7-2">
                                b) Công việc đòi hỏi sự sáng tạo và có không gian để thử nghiệm.
                            </label>
                        </div>
                    </div>
                </div>
                <div class="question">
                    <div class="question-title">8. Bạn có xu hướng chọn lựa công việc, học tập dựa trên gì? <span
                            class="required">*</span></div>
                    <div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q8" id="q8-1"
                                value="a) Các yếu tố thực tế, có thể đo lường và phân tích.">
                            <label class="form-check-label" for="q8-1">
                                a) Các yếu tố thực tế, có thể đo lường và phân tích.
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q8" id="q8-2"
                                value="b) Những cơ hội mới, những khía cạnh thú vị hoặc sáng tạo.">
                            <label class="form-check-label" for="q8-2">
                                b) Những cơ hội mới, những khía cạnh thú vị hoặc sáng tạo.
                            </label>
                        </div>
                    </div>
                </div>
                <div class="question">
                    <div class="question-title">9. Bạn cảm thấy sao về các kế hoạch và lịch trình? <span
                            class="required">*</span></div>
                    <div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q9" id="q9-1"
                                value="a) Thích có kế hoạch rõ ràng, tuân thủ các quy định.">
                            <label class="form-check-label" for="q9-1">
                                a) Thích có kế hoạch rõ ràng, tuân thủ các quy định.
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q9" id="q9-2"
                                value="b) Thích linh hoạt, đôi khi không theo kế hoạch cụ thể.">
                            <label class="form-check-label" for="q9-2">
                                b) Thích linh hoạt, đôi khi không theo kế hoạch cụ thể.
                            </label>
                        </div>
                    </div>
                </div>
                <div class="question">
                    <div class="question-title">10. Bạn cảm thấy như thế nào về những tình huống xã hội? <span
                            class="required">*</span></div>
                    <div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q10" id="q10-1"
                                value="a) Thích tham gia vào các cuộc trò chuyện và hoạt động xã hội.">
                            <label class="form-check-label" for="q10-1">
                                a) Thích tham gia vào các cuộc trò chuyện và hoạt động xã hội.
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="q10" id="q10-2"
                                value="b) Thích quan sát và tham gia khi cảm thấy cần thiết, nhưng không quá năng động.">
                            <label class="form-check-label" for="q10-2">
                                b) Thích quan sát và tham gia khi cảm thấy cần thiết, nhưng không quá năng động.
                            </label>
                        </div>
                    </div>
                </div>
            </form>
            <div class="question-write-container" data-type="text">
                <div class="quìz-form-button text-center">
                    <button id="button-submit" type="button" class="btn btn-primary mt-3">
                        Nộp kết quả
                    </button>
                    <br><br>
                    <i>Các phần <span class="required">*</span> là bắt buộc, vui lòng nhập đủ thông tin.</i>
                </div>
            </div>
        </div>

        <!-- Loading Modal -->
        <div class="modal fade" id="loadingModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Đang phân tích kết quả...</h5>
                    </div>
                    <div class="modal-body text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3">Kết quả của bạn đang được phân tích bởi AI. Vui lòng chờ trong giây lát...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Result Modal -->
        <div class="modal fade" id="resultModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
            <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Kết Quả Đánh Giá MBTI Của Bạn</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body" id="resultContent">
                        <!-- Kết quả sẽ được hiển thị ở đây -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                        <button type="button" class="btn btn-primary" onclick="restartQuiz()">Làm lại</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('button-submit').addEventListener('click', submitQuiz);

        function submitQuiz() {
            // Kiểm tra xem tất cả câu hỏi đã được trả lời chưa
            const form = document.getElementById('quiz-form');
            const formData = new FormData(form);

            let answers = {};
            let allAnswered = true;

            for (let i = 1; i <= 10; i++) {
                const answer = formData.get(`q${i}`);
                if (!answer) {
                    allAnswered = false;
                    break;
                }
                answers[`Câu ${i}`] = answer;
            }

            if (!allAnswered) {
                alert('Vui lòng trả lời tất cả các câu hỏi trước khi nộp bài!');
                return;
            }

            // Hiển thị modal loading
            const loadingModal = new bootstrap.Modal(document.getElementById('loadingModal'));
            loadingModal.show();

            // Gọi API để phân tích kết quả
            analyzeResults(answers).then(() => {
                loadingModal.hide();
            });
        }

        async function analyzeResults(answers) {
            const apiKey = "AIzaSyA6RDY_Jlj5KjN8a85QVk8U2jLJ3Hg50sY"; // CHỈ DÙNG TEST

            // Tạo prompt với các câu trả lời
            let answersText = "";
            Object.entries(answers).forEach(([question, answer]) => {
                answersText += `${question}: ${answer}\n`;
            });

            const prompt = `Tôi đã làm 01 quiz MBTI rút gọn. Bạn hãy chấm cho tôi
Yêu cầu với công việc của bạn:
#Cấu trúc: gồm 3 phần, Kết quả, Phân tích Kết quả và Tóm tắt MBTI
#Phần Kết quả: bạn xác nhận kết quả thật ngắn gọn
#Phần Phân tích kết quả: bạn hãy phân tích kết quả chấm được, giải thích từng chữ cái trong kết quả MBTI
#Phần Tóm tắt MBTI: bạn hãy tóm tắt kết quả ngắn gọn trong vài câu
#Bạn KHÔNG đưa thêm comment gì.
#Kết quả MBTI phải là một trong 16 loại sau: ISTJ, ISFJ, INFJ, INTJ, ISTP, ISFP, INFP, INTP, ESTP, ESFP, ENFP, ENTP, ESTJ, ESFJ, ENFJ, ENTJ.
#Bạn bắt buộc phải phân tích đầy đủ cả 4 chữ cái trong kết quả MBTI.
#Bạn KHÔNG gợi ý thêm gì về Tư vấn sự nghiệp hoặc thêm bất cứ nội dùng gì khác
#Kết quả làm Quiz MBTI của tôi là:
${answersText}`;

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${encodeURIComponent(apiKey)}`;

            const payload = {
                contents: [
                    {
                        role: 'user',
                        parts: [{ text: prompt }]
                    }
                ],
                generationConfig: {
                    response_mime_type: 'application/json',
                    response_schema: {
                        type: 'OBJECT',
                        properties: {
                            mbti_result: {
                                type: 'OBJECT',
                                properties: {
                                    MBTI: { type: 'STRING' },
                                    breakdown: {
                                        type: 'ARRAY',
                                        description: 'Đây là phần thông tin diễn giải các chữ cái có trong kết quả MBTI.',
                                        items: {
                                            type: 'OBJECT',
                                            required: ['letter', 'describe'],
                                            properties: {
                                                letter: { type: 'STRING' },
                                                describe: { type: 'STRING' }
                                            }
                                        }
                                    },
                                    summary: { type: 'STRING' }
                                }
                            }
                        }
                    }
                }
            };

            try {
                const response = await fetch(url, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${await response.text()}`);
                }

                const data = await response.json();
                const result = JSON.parse(data?.candidates?.[0]?.content?.parts?.[0]?.text || '{}');

                displayResult(result.mbti_result);

            } catch (error) {
                console.error('Lỗi:', error);
                alert('Có lỗi xảy ra khi phân tích kết quả. Vui lòng thử lại!');
            }
        }

        function displayResult(result) {
            const resultContent = document.getElementById('resultContent');

            let html = `
                <div class="mbti-result">
                    <div class="mbti-type">${result.MBTI}</div>
                    <h4>Phân Tích Kết Quả</h4>
                </div>
            `;

            if (result.breakdown && result.breakdown.length > 0) {
                result.breakdown.forEach(item => {
                    html += `
                        <div class="breakdown-item">
                            <div class="breakdown-letter">${item.letter}</div>
                            <div>${item.describe}</div>
                        </div>
                    `;
                });
            }

            if (result.summary) {
                html += `
                    <div class="summary-section">
                        <h5>Tóm Tắt MBTI</h5>
                        <p>${result.summary}</p>
                    </div>
                `;
            }

            resultContent.innerHTML = html;

            // Hiển thị modal kết quả
            const resultModal = new bootstrap.Modal(document.getElementById('resultModal'));
            resultModal.show();
        }

        function restartQuiz() {
            // Reset form
            document.getElementById('quiz-form').reset();

            // Đóng modal
            const resultModal = bootstrap.Modal.getInstance(document.getElementById('resultModal'));
            resultModal.hide();

            // Scroll lên đầu trang
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>

</html>